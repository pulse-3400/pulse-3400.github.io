---
priority: 0.6
title: Milestone 1
excerpt: Figure Eight
categories: milestones
background-image: lab1-cover.png

---

### Objective
The main goal of this milestone is to have the robot follow a line and to have the robot successfully traverse the grid in a figure eight.

### Procedure

#### Hardware Modifications
We began by attaching line sensors to our robot. After testing, we realized that the sensors worked the best when they were closer to the surface, so we attached them a few millimeters from the ground. Our initial design was with two sensors attached to the front sides of the robot to detect when the robot reaches a cross section and one sensor in the back to detect when the robot has finished turning. After testing, we realized that a more practical design would be to have all three sensors in the front to allow for better corrections when the robot goes off of the line and to allow for better sensing of when the robot should turn. With this setup, the two outer sensors could sense when the robot was off of the line and also when it had reached a cross section. 

#### Software Modifications
Since the line sensors are infrared sensors that record greyscale values from 0 to 1000, we set our threshold value to be 400 to tell when the sensor is on or off the line. We adapted our functions from Lab 1 to get the robot to follow a line and move in a figure eight. To help us do this, we created a state machine. Here is an image of the state machine. 

<p align="center">
  <img src="/images/statemachine.PNG" width="700px" height="394px"/><br/>
  <i>State Machine Diagram</i>
</p>

#### State Machine Explanation
he state machine's "default" state is state 0, where it is travelling straight along one of the white lines. From there, it has two basic course correction states, states 1 and 2, which will correct for the robot veering right or left, respectively. These states use functions called correctLeft() and correctRight(), which work by accelerating the outside wheel if it is not already at full speed, or reducing the speed of the inside wheel otherwise. Though the precision of this controller algorithm is limited with the current sensor setup, the correction functions do feature configurable gains that we have used to minimize overcorrection.
Any of states 0, 1, or 2 can transition to state 3, which occurs when the robot reaches a cross in the lines. From here, it will progress directly to state 4, where it stops at the cross. The machine will set a variable high indicating that it is waiting for a command, which currently either tells it to turn right or left, but will also allow the robot to continue straight in later versions. Once the robot receives a turning command, it will proceed to states 5 and 6 for a right turn, or states 7 and 8 for a left turn. The pairs of states contain intermediate conditions that the robot must meet while it makes its turn, including expected line patterns and minimum durations. Once the robot completes either state 6 or 8 and has finished the maneuver, it returns to state 0 to continue straight along the selected path, making course adjustments as necessary.
States 9 through 11 are intended to allow the robot to return to the lines in the case that it is completely off course (all three sensors are seeing a dark surface). They are not currently tuned as well as the other states, but this has not been an issue as the other states have proven completely effective at keeping the robot on the white lines. When starting the robot off of the course, they work with reasonable consistency. They will be further improved in the future for robustness' sake.

